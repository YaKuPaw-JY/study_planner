# 邮箱提醒功能配置指南

## 📧 配置步骤

### 第一步：获取邮箱授权码

#### QQ邮箱配置步骤：

1. **登录QQ邮箱**
   - 访问：https://mail.qq.com
   - 登录你的QQ邮箱

2. **开启SMTP服务**
   - 点击邮箱右上角的"设置"
   - 选择"账户"选项卡
   - 找到"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务"
   - 开启"POP3/SMTP服务"或"IMAP/SMTP服务"
   - 按照提示发送短信验证
   - 验证后会获得一个**授权码**（16位字符，不是QQ密码）

3. **配置 application.yml**
   ```yaml
   spring:
     mail:
       host: smtp.qq.com
       port: 587
       username: 你的QQ号@qq.com  # 例如：123456789@qq.com
       password: 你的授权码  # 刚才获取的16位授权码
   ```

### 需要提醒的是，我仅测试了小号qq邮箱的SMTP服务，其他邮箱配置未经验证，为AI生成，可能与显示有出入
### 以及由于在调试过程中可能出现大量无效邮件短时间发送，有异常账号封禁的概率，建议使用非常用邮箱进行测试
### 有个别测试账号使用“假邮箱”，会出现报错，建议nanlingyin考虑修改为不填写/虚拟邮箱

#### 163邮箱配置步骤：

1. **登录163邮箱**
   - 访问：https://mail.163.com
   - 登录你的163邮箱

2. **开启SMTP服务**
   - 点击"设置" → "POP3/SMTP/IMAP"
   - 开启"POP3/SMTP服务"和"IMAP/SMTP服务"
   - 按照提示获取授权码

3. **配置 application.yml**
   ```yaml
   spring:
     mail:
       host: smtp.163.com
       port: 587
       username: 你的邮箱@163.com
       password: 你的授权码
   ```

#### Gmail配置步骤：

1. **登录Gmail**
   - 访问：https://mail.google.com
   - 登录你的Gmail账户

2. **开启"不够安全的应用访问"**
   - 访问：https://myaccount.google.com/lesssecureapps
   - 开启"允许不够安全的应用"

3. **配置 application.yml**
   ```yaml
   spring:
     mail:
       host: smtp.gmail.com
       port: 587
       username: 你的Gmail地址@gmail.com
       password: 你的Gmail密码
   ```

### 第二步：修改配置文件

编辑 `study_planner/src/main/resources/application.yml` 文件：

```yaml
spring:
  mail:
    host: smtp.qq.com  # 根据你的邮箱修改
    port: 587
    username: 你的邮箱地址  # 修改为你的邮箱
    password: 你的授权码  # 修改为你的授权码
    default-encoding: UTF-8
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000
```

### 第三步：重启后端服务

配置完成后，重启Spring Boot应用。

### 第四步：测试邮件功能

#### 方式1：等待自动检查（推荐）
- 定时任务每5分钟自动执行一次
- 如果计划超过3分钟未打卡，会自动发送邮件
- 查看控制台日志确认

#### 方式2：手动触发测试
发送POST请求：
```bash
curl -X POST http://localhost:8080/api/reminder/check
```

或者使用Postman等工具发送POST请求到：
```
http://localhost:8080/api/reminder/check
```

## ⚙️ 功能说明

### 提醒规则
- **测试环境**：计划超过**3分钟**未打卡会发送提醒
- **生产环境**：需要修改为**3天**（4320分钟）

### 修改提醒时间
编辑 `PlanReminderService.java`：
```java
// 测试环境：3分钟
// 生产环境：改为 3 * 24 * 60 = 4320 分钟
private static final long INACTIVE_MINUTES = 3; // 改为 4320
```

### 修改检查频率
编辑 `PlanReminderService.java`：
```java
@Scheduled(fixedRate = 300000) // 5分钟（测试）
// 生产环境改为：fixedRate = 3600000（每小时）
```

## 🔍 验证配置

配置完成后，查看控制台日志：
- ✅ 如果看到"邮件发送成功"，说明配置正确
- ❌ 如果看到"邮件服务未配置"或"邮件发送失败"，检查配置是否正确

## ⚠️ 注意事项

1. **授权码不是登录密码**：必须使用邮箱提供的授权码
2. **确保用户有邮箱**：提醒只会发送给注册时填写了邮箱的用户
3. **测试环境**：当前设置为3分钟，生产环境请改为3天
4. **避免重复提醒**：当前版本每次检查都会发送，生产环境建议添加提醒记录表

## 📝 常见问题

**Q: 收到"邮件发送失败"错误？**
A: 检查：
- 授权码是否正确
- 邮箱是否开启了SMTP服务
- 网络连接是否正常

**Q: 没有收到邮件？**
A: 检查：
- 用户注册时是否填写了邮箱
- 检查垃圾邮件文件夹
- 查看控制台日志确认是否发送

**Q: 如何禁用邮件功能？**
A: 在 `application.yml` 中注释掉 `mail:` 配置即可

